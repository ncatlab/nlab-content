# Coend calculus

_Coend calculus_ rules the behaviour of certain universal objects associated to functors of two variables $T : C^{op}\times C \to D$; intuitively, $end(T)$ stands to $T$ as the limit $\lim F$ of $F : A \to B$ stands to $F$; the major difference is that $end(T)$ takes into account the fact that $T$ eats two objects of $C$, once covariantly and once contravariantly: indeed, on arrows $f : c\to c'$ the functor $T$ acts as follows:

$$
\begin{array}{ccccc}
&& T(c',c) && \\
&\overset{T(f,c)}\swarrow && \overset{T(c',f)}\searrow &\\
T(c,c) &&&& T(c',c')
\end{array}
$$

A distinguising feature of objects that depend on the same variable once covariantly, and once contravariantly is that they can be _integrated_: given a sufficiently regular function $f(x)$, its dependence from $x$ can be thought as "covariant", whereas the "$dx$" in

$$
\int f(x)d x
$$

can be thought of as exhibiting a contravariant dependence of $\int f$ from $x$.

Ends and coends are associated to functors $T : C^{op}\times C \to D$ in a way that resembles integrals: they are certain objects $\int_c T(c,c)$ (the end) and $\int^c T(c,c)$ (the coend), associated to $T$ in a certain canonical fashion, treating $c$ as a mute variable (meaning that $\int_c T(c,c)$ and $\int_{c'} T(c',c')$ are the same object), and satisfying a "commutative rule of integrals" analogous to

$$
\int f(x,y) d x d y = \int \Big(\int f(x,y)d x\Big) d y = \int \Big(\int f(x,y)d y\Big) d x
$$

This intuition can of course be made more precise: every universal object built in category theory can be thought either as a subobject of a product (a limit), or as a quotient of a coproduct (a colimit), and co/ends make no exception:

-   An end arises as an "object of invariants" $\int_c T$ for the action of $T$ given by the arrow functions $T_{x y} \hom_{C^{op}\times C}(x,y) \to D(T x, T y)$, and it is defined as the subobject of $\prod_{c\in C} T(c,c)$ of those elements invariant under this action.
-   Dually, a _coend_ arises quotienting $\coprod_{c\in C}T(c,c)$ by a suitable equivalence relation generated by same functions $T_{x y} \hom_{C^{op}\times C}(x,y) \to D(T x, T y)$, i.e. as a _space of orbits_ for the action.

Quite astoundingly, starting from this simple intuition it is possible to find such covariant-contravariant actions at every corner of category theory, to re-state the Yoneda lemma and the theory of Kan extensions in terms of co/ends, and to find plenty of applications to algebra, topology, geometry... and functional programming :-)

## Dinaturality

As already said, any functor $T : C^{op}\times C \to D$ acts on morphisms as
$$
\begin{array}{ccccc}
&& T(c',c) && \\
&\overset{T(f,c)}\swarrow && \overset{T(c',f)}\searrow &\\
T(c,c) &&&& T(c',c')
\end{array}
$$
given _two_ such functors, say $P,Q : C^{op}\times C \to D$, we can consider the two diagrams
$$
bla
$$
and
$$
ble
$$
Now, given two functors $F,G : A \to B$ a natural transformation can be seen as a family of maps that "fill the gap" between $F(f)$ and $G(f)$ in a commutative square
$$
blu
$$
In a similar fashion, a _dinatural_ transformation between the above $P,q$ can be seen as a way to close a certain diagram that testifies a transformation from the arrow action of $P$ to the arrow action of $Q$:
$$
\begin{array}{ccccc}
&& P(c',c) && \\
&\overset{P(f,c)}\swarrow && \overset{P(c',f)}\searrow &\\
P(c,c) &&&& P(c',c')\\
\!\!\!\!\alpha_c\downarrow &&&&\,\,\,\,\,\,\,\downarrow\alpha_{c'} \\
Q(c,c)&&&& Q(c',c')\\
&\underset{Q(c,f)}\nwarrow&& \underset{Q(f,c')}\nearrow& \\
&&Q(c,c')&& \\
\end{array}
$$


## The building blocks of co/end calculus

Nat - Yoneda - Kan

# Profunctors

Pastro and Street paper makes heavy use of the theory of _profunctors_.

# Doubles for monoidal categories
