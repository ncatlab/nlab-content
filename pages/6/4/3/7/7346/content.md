+-- {: .rightHandSide}
+-- {: .toc .clickDown tabindex="0"}
###Context###
#### Algebra
+--{: .hide}
[[!include higher algebra - contents]]
=--
=--
=--

#Contents#
* table of contents
{:toc}

## Idea 

Nakayama's lemma is a simple but fundamental result of commutative algebra frequently used to lift information from the [[fiber]] of a [[sheaf]] over a point (as for example a [[coherent sheaf]] over a [[scheme]]) to give information on the [[stalk]] at that point. 


## Statement

We give a general version of the Nakayama's lemma (Prop. \ref{GeneralNakayamaLemma}) and then two special cases that are often considered (Prop. \ref{FirstSpecialVersion} and Prop. \ref{SecondSpecialVersion}).

\begin{proposition}\label{GeneralNakayamaLemma}
**(Nakayama's lemma**)
\linebreak
Let $R$ be a [[commutative ring]] and $M$ be a [[finitely generated]] [[module|$R$-module]]. Then:

1. $\text{supp}(M) = \mathcal{V}(Ann(M))$.

2. If moreover $I\subseteq R$ is an ideal with $supp(M)\cap V(I)$ inhabited, then $M\otimes_{R} R/I$ is nonzero. 

\end{proposition}
Recall here that $supp(M) = \{\mathfrak{p}\in Spec(R)\ \text{ s.t. }\ M\otimes_{R} R_{\mathfrak{p}}\ \text{ is nonzero}\}$, $Ann(M) = \{f \in R\ \text{ s.t. }\ f M = 0\}$, and $\mathcal{V}(I) = \{\mathfrak{p} \in Spec(R)\ \text{ s.t. }\ \mathfrak{p} \supseteq I\}$. The first claim is not usually considered part of Nakayama's lemma but will be useful here and can be proved with a closely related argument to that which we will use for the main result.)

The following proof uses relatively little pre-existing commutative algebraic theory (i.e., just some basic facts about $\mathcal{V}$, nonzeroness in short exact sequences, localization, tensoring, and localizing/tensoring cyclic modules) 
\begin{proof}

The argument proceeds in the following four steps:

1. As $M$ is finitely generated, it admits a filtration with cyclic cokernels. To be explicit, if the $n$-tuple of elements $(m_{k}\in M)_{k=0,\dots,n-1}$ generates $M$, then it begets an $n$-tuple of short exact sequences 
\[\left(\ 0 \to M_{k} \to M_{k+1} \to R/I_{k} \to 0\ \right)_{k=0,\dots,n-1},\] 
where $M_{k}$ is the submodule of $M$ spanned by $(m_{k}\in M)_{k=0,\dots,k-1}$ and in particular $M_{0}=0$ and $M_{n}=M$. (Here the maps $M_{k} \to M_{k+1}$ are the evident inclusions; as the cokernel is generated by the image of $m_{k}$, it is in particular isomorphic to $R/I_{k}$ for some ideal $I_{k}\subseteq R$.) The basic idea is that the process of extension by which $M$ is built up from these $R/I_{k}$s interacts sufficiently nicely with the operations of localization/taking fibers that the properties of the latter determine those of the former.
 
2. For instance, it is clear that any $f \in Ann(M)$ must descend to $0$ on all the $R/I_{k}$s; on the other hand, for all $k=0,\dots,n-1$ we have that $I_{k}M_{k+1} \subseteq M_{k}$. We conclude that $\prod_{k=0}^{n-1} I_{k} \subseteq Ann(M) \subseteq \bigcap_{k=0}^{n-1} I_{k}$, whence $\mathcal{V}(Ann(M)) = \bigcup_{k=0}^{n-1} \mathcal{V}(I_{k})$.

3. Let us now show that $supp(M) = \bigcup_{k=0}^{n-1} \mathcal{V}(I_{k})$; this will complete the proof of our first claim. Recall that for any $\mathfrak{p}\in Spec(R)$ the functor $-\otimes_{R} R_{\mathfrak{p}}$ is exact; we therefore in any case obtain an $n$-tuple of short exact sequences 
\[\left(\ 0 \to M_{k} \otimes_{R} R_{\mathfrak{p}} \to M_{k+1} \otimes_{R} R_{\mathfrak{p}} \to R/I_{k} \otimes_{R} R_{\mathfrak{p}} \to 0\ \right)_{k=0,\dots,n-1}.\] 
If $\mathfrak{p} \notin \bigcup_{k=0,\dots,n-1} \mathcal{V}(I_{k})$, then each $R/I_{k} \otimes_{R} R_{\mathfrak{p}}$ vanishes, so the above SESs collapse to isomorphisms 
\[\left(\ 0 \to M_{k} \otimes_{R} R_{\mathfrak{p}} \to M_{k+1} \otimes_{R} R_{\mathfrak{p}} \to 0\ \right)_{k=0,\dots,n-1}\]
and thus 
\[M \otimes_{R} R_{\mathfrak{p}} \simeq M_{n} \otimes_{R} R_{\mathfrak{p}} \simeq M_{0} \otimes_{R} R_{\mathfrak{p}} \simeq 0.\] 
Conversely, if $\mathfrak{p} \notin \bigcup_{k=0,\dots,n-1} \mathcal{V}(I_{k})$, then there is a maximal index $k_{max}$ such that $\mathfrak{p} \supseteq I_{k_{max}}$ and in particular an epimorphism 
\[M_{k_{max}+1} \otimes_{R} R_{\mathfrak{p}} \to R/I_{k_{max}} \otimes_{R} R_{\mathfrak{p}} \to 0,\]
with $R/I_{k_{max}} \otimes_{R} R_{\mathfrak{p}}$ nonzero. But there are also, as before, isomorphisms
\[\left(\ 0 \to M_{k} \otimes_{R} R_{\mathfrak{p}} \to M_{k+1} \otimes_{R} R_{\mathfrak{p}} \to 0\ \right)_{k=k_{max}+1,\dots,n-1}\]
whence
\[M \otimes_{R} R_{\mathfrak{p}} \simeq M_{n} \otimes_{R} R_{\mathfrak{p}} \simeq M_{k_{max}+1} \otimes_{R} R_{\mathfrak{p}}\] 
is epic onto a nonzero module and thus itself nonzero.

4. The proof of the second claim is in the same vein, requiring just a little bit more delicacy. Suppose that $\mathfrak{p}$ inhabits $\text{supp}(M)\cap V(I)$; by the above this means that $\mathfrak{p}\supseteq I$ and that there exists some index $k$ for which $\mathfrak{p}\supseteq I_{k}$. Again consider the maximal index $k_{max}$ for which $\mathfrak{p} \supseteq I_{k_{max}}$. As before, there is an epimorphism 
\[M_{k_{max}+1} \otimes_{R} R_{\mathfrak{p}} \to R/I_{k_{max}} \otimes_{R} R_{\mathfrak{p}} \to 0\] 
and isomorphisms 
\[\left(\ 0 \to M_{k} \otimes_{R} R_{\mathfrak{p}} \to M_{k+1} \otimes_{R} R_{\mathfrak{p}} \to 0\ \right)_{k=k_{max}+1,\dots,n-1}\]
By the right-exactness of the functor $-\otimes_{R} R/\mathfrak{p}$, we obtain from the former an epimorphism 
\[M_{k_{max}+1} \otimes_{R} R_{\mathfrak{p}} /\mathfrak{p} \to R/I_{k_{max}} \otimes_{R} R_{\mathfrak{p}}/\mathfrak{p} \to 0\] 
(implicitly using that $(- \otimes_{R} R_{\mathfrak{p}})\otimes_{R} R/\mathfrak{p}\ \simeq\ - \otimes_{R} R_{\mathfrak{p}}/\mathfrak{p}$). 
By its functoriality, there are likewise isomorphisms
\[\left(\ 0 \to M_{k} \otimes_{R} R_{\mathfrak{p}}/\mathfrak{p} \to M_{k+1} \otimes_{R} R_{\mathfrak{p}}/\mathfrak{p} \to 0\ \right)_{k=k_{max}+1,\dots,n-1}\]
Now,
\[R/I_{k_{max}} \otimes_{R} R_{\mathfrak{p}}/\mathfrak{p} \simeq R_{\mathfrak{p}}/\mathfrak{p}\] 
is nonzero (here we use that $\mathfrak{p} \supseteq I_{k_{max}}$). It follows that 
\[M \otimes_{R} R_{\mathfrak{p}}/\mathfrak{p} \simeq M_{n} \otimes_{R} R_{\mathfrak{p}}/\mathfrak{p} \simeq M_{k_{max}+1} \otimes_{R} R_{\mathfrak{p}}/\mathfrak{p}\]
is epic onto a nonzero module and thus itself nonzero.
But 
\[M \otimes_{R} R_{\mathfrak{p}}/\mathfrak{p} \simeq (M \otimes_{R} R/I) \otimes_{R} R_{\mathfrak{p}}/\mathfrak{p}\]
(here we use that $\mathfrak{p} \supseteq I$), so the latter must itself be nonzero, as claimed.

\end{proof}

It is now straightforward to recover more familiar forms of Nakayama's lemma as a corollary of the above. 

\begin{proposition}\label{FirstSpecialVersion}
**(special version 1)** 
\linebreak
Let $R$ be a local ring with maximal ideal $\mathfrak{m}\subseteq R$ and $M$ be a finitely generated $R$-module. Then if $M$ is nonzero, so too is $M \otimes_R R/\mathfrak{m}$. 
\end{proposition}
\begin{proof}
Indeed, $\mathfrak{m}$ is practically tautologically in (and so $\mathcal{V}(\mathfrak{m})$ practically tautologically intersects) the support of any nonzero $R$-module; the conditions of Prop. \ref{GeneralNakayamaLemma}, and we conclude that $M \otimes_R R/\mathfrak{m}$ is nonzero as advertised.
\end{proof}

Sometimes (for instance in the [Stacks Project](https://stacks.math.columbia.edu/tag/07RC)), Nakayama's lemma is stated instead as follows:

\begin{proposition}\label{SecondSpecialVersion}
**(special version 2)** 
\linebreak
Let $R$ be a commutative ring, $M$ be a finitely generated $R$-module, and $I\subseteq R$ be an ideal with $I M = M$. Then there exists $f\in R$ such that $f = 1\ (mod\ I)$ and $f M=0$.
\end{proposition}
\begin{proof}
Of course, $I M = M\ \iff\ M \otimes_{R} R/I \simeq 0$; it follows from Prop. \ref{GeneralNakayamaLemma} that $I$ is comaximal with $Ann(M)$. The [Chinese Remainder theorem](https://stacks.math.columbia.edu/tag/00DT) then asserts the existence of $f\in R$ such that $f = 1\ (mod\ I)$ and $f = 0\ (mod\ Ann(M))$; the desired $f$.
\end{proof}

## Examples and consequences

\begin{example}
Suppose $f \colon N \to M$ is an $R$-module map, giving rise to an exact sequence 

$$N \stackrel{f}{\to} M \stackrel{p}{\to} M/N \to 0.$$ 

Tensoring with $k$ is a right exact functor, so we have an exact sequence 

$$k \otimes_R N \stackrel{k \otimes_R f}{\to} k \otimes_R M \to k \otimes_R M/N \to 0.$$ 

Nakayama's lemma says that if $k \otimes_R M/N \cong 0$, then $M/N \cong 0$. Equivalently, that if $k \otimes_R f$ is epic, then $f$ is epic. In particular, to check whether a finite set of elements $v_1, \ldots, v_n$ generates $M$, it suffices to check whether the residue classes $v_i \mod \mathfrak{m}M$ generate the vector space $M/\mathfrak{m}M$, which is a linear algebra calculation. 
\end{example}


\begin{example}
Suppose $O$ is a [[Noetherian ring|Noetherian]] local ring. A typical example is the stalk at a point $p$ of a Noetherian scheme as locally ringed space, and we will write as if we were in that situation. Being Noetherian, its maximal ideal $\mathfrak{m}$ is finitely generated. Suppose $k \otimes_O \mathfrak{m} \cong \mathfrak{m}/\mathfrak{m}^2$ -- the cotangent space -- is a vector space of dimension $n$. We would like to know whether a collection of functions $f_1, \ldots, f_n$ that vanish at $p$ form a local coordinate system. 

For this, it suffices to check whether the differentials $d f_1, \ldots, d f_n$ at $p$, belonging to the cotangent space $\mathfrak{m}/\mathfrak{m}^2$, are linearly independent. (For then they span the cotangent space, and one concludes from Nakayama that the $f_i$ generate $\mathfrak{m}$ as an $O$-module, thereby forming a local coordinate system at $p$.) In this way, Nakayama's lemma operates as a kind of "inverse function theorem". 
\end{example}

To cement this further, the following statement is offered in [Harris](#Harris) as a corollary of Nakayama's lemma (corollary 14.10, page 179): 

+-- {: .num_prop}
###### Proposition 
**(Inverse Function Theorem)** 
A map between complex projective varieties of dimension $n$ which is a bijection and has injective derivative at every point is an isomorphism. 
=-- 


[[!redirects Nakayama lemma]]
