+-- {: .rightHandSide}
+-- {: .toc .clickDown tabindex="0"}
###Context###
#### Constructivism, Realizability, Computability
+-- {: .hide}
[[!include constructivism - contents]]
=--
#### Category theory
+-- {: .hide}
[[!include category theory - contents]]
=--
=--
=--


# Thunk-force category
* table of contents
{:toc}

## Idea

A **thunk-force category** is a category that models [[call-by-value]] programming languages with effects.
More commonly, terms in a call-by-value language are modelled as morphisms in the [[Kleisli category]] of a [[strong monad]].
A thunk-force category axiomatizes the Kleisli category _directly_ and is also called an **abstract Kleisli category**[^terminology].
The original category can be recovered from this category if it satisfies certain properties.

The name derives from programming terminology. A **thunk** means a value that represents an unevaluated computation, which can later be **forced** to be evaluated and perform its [[side effects]]. This is represented by the object $L A$ which could be read as a "thunk of $A$" or a "lazy $A$". The thunking arrow $\theta_A : A \to L A$ embeds a value as a trivial thunk, and the force $\epsilon_A : L A \to A$ forces the evaluation of its thunked input.

The type constructor $L$ and associated thunk and force don't normally appear as a standalone feature in a call-by-value language, but if the language supports first-class functions, they can be implemented in the usual way as a function of unit input.
On the model this corresponds to the fact that if a thunk-force category is [[closed monoidal category|monoidal closed]] in an appropriate sense, then $L A$ is equivalent to $I \rightharpoonup A$ and $\theta, \epsilon$ can be defined using this structure.

## Definition

A thunk-force category [Führmann 99](#F99) consists of

* a category $K$
* a functor $L : K \to K$
* a [[unnatural transformation|possibly unnatural transformation]] $\theta : Id_K \to L$ pronounced **thunk**
* a [[natural transformation]] $\epsilon : L \to Id_K$ pronounced **force**

such that

* $(L\theta)\theta = (\theta L)\theta$
* $\theta L$ is a natural transformation
* $\epsilon\theta = \id$
* $(L\epsilon)(\theta L) = \id$

A morphism $f : A \to B$ in a thunk-force category is **thunkable** if $( L f )\theta = \theta f$.
Then the conditions can be rephrased as

* $\theta$ is thunkable
* $(L,\epsilon,\theta L)$ is a [[comonad]].

## Relation to Monads

Let $(T,\eta,\mu)$ be a [[monad]] on a category $C$. The [[Kleisli category]] of $T$ is a thunk-force category. Let $F \dashv G$ denote the adjunction between $C$ and the Kleisli category $C_T$. Define $L = FG$ and $\epsilon$ the counit of the comonad. To define $\theta$, take $F\eta : F \to FT$ and, using the fact that $F$ is an [[identity-on-objects functor]] (or at least bijective on objects), treat it as an [[unnatural transformation]] from $Id_{C_T}\to L$. Then it follows immediately by naturality that every morphism in the image of $F$ is thunkable.

More explicitly, using the "Kleisli arrow" definition of the Kleisli category, $L$ 
is just $T$, $\epsilon_A : T A \to T A$ is the identity, and $\theta_A = \eta_{T A} \eta_{A} : A \to T^2 A$.

In the opposite direction, starting with a thunk-force category $K$, we can define the (non-full) subcategory of thunkable morphisms $G_\theta K$. Since $\theta L$ is natural, the image of $L$ lands in this subcategory, and is right adjoint to the inclusion. Then there is a monad $L_\theta$ induced on $G_{\theta}K$ by this adjunction.
Furthermore, the thunk-force category generated by the Kleisli category of the monad is equivalent to $K$.

These constructions exhibit the category of thunk-force categories as a [[reflective subcategory]] of the category of monads. The subcategory can be characterized as the monads satisfying the "equalizing requirement", that the unit $\eta$ of the monad is an equalizer in the following diagram:

$$
1_{C}\underset{\quad \eta \quad}{\to}T\underoverset{\quad \eta T \quad}{T \eta}{\rightrightarrows}T^2
$$


The definition of the category of morphism of thunk-force categories and proof of this theorem are in [Führmann 99 section 5](#F99).

## References

Thunk-force categories were introduced (under the name "abstract Kleisli categories" in 

* {#F99} Carsten Führmann, "Direct Models of the Computational Lambda-calculus" Electronic Notes in Theoretical Computer Science 1999

[^terminology]: We prefer the term thunk-force category since it is ambiguous whether [[Kleisli category]] refers to the Kleisli category of a [[monad]] or a [[comonad]].