
+-- {: .rightHandSide}
+-- {: .toc .clickDown tabindex="0"}
### Context
#### Category theory
+-- {: .hide}
[[!include category theory - contents]]
=--
=--
=--


#Contents#
* table of contents
{:toc}


## Idea ##

In [[category theory]], an _allegory_ is a [[category]] with properties meant to reflect properties that hold in a category [[Rel]] of [[relations]]. The notion was first introduced (as far as we know) and certainly first made famous in the book _[[Categories, Allegories]]_ ([Freyd-Scedrov](#FreydScedrov)). 

Freyd and Scedrov argue that a categorical calculus of relations is an alternative and often more amenable framework for developing concepts traditionally couched in "functional" language (i.e., concepts which apply to sets and functions); for instance, a principal _raison d'etre_ for [[regular categories]] is precisely that one can do relational calculus in them (as had been long known, e.g., Mac Lane showed how to calculate with relations to do diagram chases in [[abelian categories]]). Allegories, and correlative notions such as [[bicategory of relations|bicategories of relations]], also offer a smooth approach to [[regular and exact completion|regular and exact completions]], as used for example in the construction of [[realizability topos|realizability toposes]]. 

A signal feature of allegories is emphasis on the modular law (see below), which generalizes the [[modular lattice|modular law]] in lattices to more general relations, and which generalizes also so-called [[Frobenius reciprocity]] in categorical logic. 

## Definition

An **allegory** is a [[(1,2)-category]] $A$ equipped with an [[involution]] $(-)^o \colon A^{op} \to A$ which is the identity on objects, such that

* each [[hom-object|hom-poset]] $A(x,y)$ has binary [[intersections]], and
* the *[[modular lattice|modular law]]* holds: for $\phi\colon x\to y$, $\psi\colon y\to z$, and $\chi\colon x\to z$, we have $\psi \phi \cap \chi \le \psi (\phi \cap \psi^o \chi)$. 

## Examples 

* If $C$ is a [[regular category]] and $Rel(C)$ is the [[locally posetal 2-category|locally posetal]]  [[bicategory]] of [[relations]], then $Rel(C)$ is an allegory. 

* Any [[first-order hyperdoctrine with equality]] similarly gives rise to an allegory, as does any abstract [[bicategory of relations]] in the sense of Carboni-Walters. 

* Any [[modular lattice]] can be regarded as a one-object allegory if we take composition to be union and the involution to be the identity. 

## Maps, tabulations, and units

A **map** in an allegory is a morphism that has a [[right adjoint]].

Any 2-category has a [[bicategory of maps]].  In an allegory, the ordering between maps is discrete, meaning that if $f \leq g$ then $f = g$.  Consequently, the bicategory of maps of an allegory is a [[category]].

A **tabulation** of a morphism $\phi$ is a pair of maps $f,g$ such that $\phi = g^o f$ and $f^o f \cap g^o g = 1$.  An allegory is **tabular** if every morphism has a tabulation, and **pretabular** if every morphism is contained in one that has a tabulation.

Every [[regular category]], and indeed every [[locally regular category]], has a tabular allegory of internal binary relations.  Conversely, by restricting to the morphisms with left adjoints ("maps") in a tabular allegory, we obtain a locally regular category.  These constructions are inverse, so tabular allegories are equivalent to locally regular categories.

A locally regular category has finite products if and only if its tabular allegory of relations has top elements in its hom-posets.

Finally, a **unit** in an allegory is an object $U$ such that $1_U$ is the greatest morphism $U\to U$, and every object $X$ admits a morphism $\phi\colon X\to U$ such that $1_X\le \phi^o\phi$.  A locally regular category has a terminal object (hence is regular) if and only if its tabular allegory of relations has a unit.

Thus, regular categories are equivalent to unital (or unitary) tabular allegories.  For more details, see [[Categories, Allegories]], the [[Elephant]], or [[toddtrimble:Theory of units and tabulations in allegories]].


## Division allegories and power allegories

A **distributive allegory** is an allegory whose hom-posets have finite joins that are preserved by composition.  Thus a distributive allegory is locally a [[lattice]].  The category of maps in a unitary tabular distributive allegory is a [[pre-logos]], and conversely the bicategory of relations in a pre-logos is a unitary tabular distributive allegory.

A **division allegory** is a distributive allegory in which composition on one (and therefore the other) side has a right adjoint (left or right division). That is: given $r \colon A \to B$ and $s \colon A \to C$, there exists $r/s \colon B \to C$ such that

$$t \leq s/r \in \hom(B, C) \Leftrightarrow t \circ r \leq s \in \hom(A, C)$$ 

(so that $- \circ r$ has right adjoint $-/r$: an example of a right [[Kan extension]]). Composition on the other side, $r \circ -$, has a right adjoint (an example of a right Kan lift) given by 

$$r\backslash u \coloneqq (u^o/r^o)^o.$$ 

In the bicategory of sets and relations, with notation as above, we have 

$$(s/r)(b, c) \dashv \vdash \forall_{a \colon A} r(a, b) \Rightarrow s(a, c)$$

where $r(a, b)$ is shorthand for "$(a, b)$ belongs to $r$". 

The category of maps (functional relations) of a unitary/unital tabular division allegory is a [[logos]], and conversely the bicategory of relations in a logos is a unitary tabular division allegory. ([[Categories, Allegories]], 2.32, page 227.) 

A **power allegory** is an allegory $\mathcal{A}$ such that the inclusion functor $Map(\mathcal{A}) \to \mathcal{A}$ has a right adjoint $P$. The counit at an object $B$ may be written 

$$\ni_B \colon P(B) \to B$$ 

and we have the [[comprehension axiom]] that to each $r \colon A \to B$ there is a map $\chi_r \colon A \to P(B)$ such that $r = \ni_B \circ \chi_r$. 

+-- {: .num_theorem} 
###### Theorem 
A power allegory is a division allegory. 
=-- 

+-- {: .proof} 
###### Proof (sketch) 
Let $r \colon A \to C$ and $s \colon B \to C$ be morphisms; we construct a right Kan lift $s \backslash r$ of $r$ through $s$. This means that for all $t \colon A \to B$ we have $s \circ t \leq r$ if and only if $t \leq s \backslash r$. 

We construct $s \backslash r$ as $\chi_s^o [\geq] \chi_r$ where $[\geq] \colon P(C) \to P(C)$ is a relation opposite to the internalization $[\leq]$ of the external order. One way to define $[\leq]$ is 

$$[\leq] = (P(C) \stackrel{\ni^o}{\to} P P(C) \stackrel{\bigcup}{\to} P(C)$$ 

where $\bigcup \colon P P(C) \to P(C)$ internalizes the union operation, and is defined to be the map that classifies the composite 

$$P P(C) \stackrel{\ni_{P(C)}}{\to} P(C) \stackrel{\ni_C}{\to} C.$$

(Full details to appear.) 
=--

In other language, a power allegory is a division allegory which associates to each object $B$ a morphism $\ni_B \colon P(B) \to B$ such that for all $r \colon A \to B$

* $1_A \leq (r \backslash \ni_B) \circ (\ni_B \backslash r)$ 

which expresses the truth of the formula $\forall_{a \colon A} \exists_{S: P(B)} \forall_{b \colon B} S \ni_B b \Leftrightarrow r(a, b)$, and 

* $(\ni_B \backslash \ni_B) \wedge (\ni_B \backslash \ni_B)^o \leq 1_{P(B)}$ 

which internalizes an axiom of extensionality, which reads $\forall_{b \colon B} (S \ni_B b) \Leftrightarrow (T \ni_B b) \vdash S = T$. Given those axioms, and given $r \colon A \to B$, one may define

$$\chi_r \coloneqq (\ni_B \backslash r) \wedge (r\backslash \ni_B)^o,$$ 

which internalizes the formula-definition $\chi_r(a, S) \coloneqq \forall_b S \ni_B b \Leftrightarrow r(a, b)$, and then show $\chi_r$ is a map. (See Categories, Allegories, pp. 235-236.) 

The bicategory of relations in a [[topos]] is a power allegory; conversely, the category of maps in a unitary tabular power allegory is a topos. 


## Syntactic allegories

Let $T$ be a [[regular theory]].  There is then an allegory $\mathcal{A}_T$ given as follows:

* the objects are finite strings of [[sorts]] of $T$;
* a morphism $\vec X \to \vec Y$ is a predicate $P(\vec x, \vec y)$ of sort $\vec X, \vec Y$ (or rather a provable-equivalence class of such predicates);
* the identity $\vec X \to \vec X$ is (named by) $x_1 = x_1 \wedge x_2 = x_2 \wedge \cdots \wedge x_n = x_n$;
* the composite of $R \colon \vec X \to \vec Y$ and $S \colon Y \to \vec X$ is named by $\exists \vec y. R(\vec x, \vec y) \wedge S(\vec y, \vec z)$.

That $\mathcal{A}_T$ is an allegory is B.311 in [Freyd--Scedrov](#FreydScedrov); that it is in fact unitary and pre-tabular is B.312.

Further structure on $T$ gives rise to further structure on $\mathcal{A}_T$ (B.313): if $T$ is a [[coherent theory|coherent]], [[first-order theory|first-order]] or [[higher-order logic|higher-order]] theory, then $\mathcal{A}_T$ will be a distributive, division or power allegory respectively.

Every pre-tabular allegory has a tabular completion, given by splitting its coreflexive morphisms (i.e. those endomorphisms $R$ such that $R \subset id$).  The category of maps in the coreflexive splitting of $\mathcal{A}_T$ is precisely the [[syntactic category]] of $T$.

### The existential quantifier

There are two possible ways to interpret a regular formula of the form $\exists y. R(x,y) \wedge S(y,z)$ in a unitary pre-tabular allegory, if $R$ and $S$ are interpreted as $r \colon X \to Y$ and $s \colon Y \to Z$ respectively:  as the composite $s \cdot r$, or more 'literally' by:
* pulling $r$ and $s^o$ back to the same hom set and taking their intersection: $(p_1^o r p_1) \cap (p_2^o s^o p_2) \colon X \times Z \to Y \times Y$;
* then forcing the two $Y$s to be equal by post-composing with $\Delta_Y^o \colon Y \times Y \to Y$, applying the existential quantifier by post-composing with the unique map $!_Y$ to the unit, and post-composing with $!_Z^o$ to get a morphism into $Z$;
* then forcing the $Z$ in the domain to be equal to the $Z$ in the codomain by taking the meet with $p_2 \colon X \times Z \to Z$;
* and finally pulling back along (precomposing with the right adjoint of) $p_1 \colon X \times Z \to X$ to get a morphism $X \to Z$.

We would like to know that these morphisms are equal, so that an existential formula will have a unique interpretation:

+-- {: .num_prop}
###### Proposition
$$ s r = (p_2 \cap !_Z^o !_Y \Delta_Y^o ((p_1^o r p_1) \cap (p_2^o s^o p_2))) p_1^o  $$
=--

+-- {: .proof}
###### Proof
We show inclusion in each direction.

Firstly, $s r = s r \cap p_2 p_1^o$, because the product projections tabulate the top morphism.  Notice also that the RHS above is equal to
$$ (\top_{Y Z} (r p_1 \cap s^o p_2) \cap p_2) p_1^o  $$
where $\top_{Y Z}$ is the top morphism $Y \to Z$.

Now we can calculate:
$$
\begin{aligned}
  s r \cap p_2 p_1^o
  & = (s r p_1 \cap p_2) p_1^o & \text{modular law} \\
  & = (s r p_1 \cap p_2 \cap p_2) p_1^o \\
  & \leq (s(r p_1 \cap s^o p_2) \cap p_2) p_1^o & \text{modular law} \\
  & \leq (\top_{Y Z} (r p_1 \cap s^o p_2) \cap p_2) p_1^o
\end{aligned}
$$

In the other direction, we have
$$
\begin{aligned}
  (\top_{Y Z} (r p_1 \cap s^o p_2) \cap p_2) p_1^o
  & \leq (\top_{Y Z} s^o (s r p_1 \cap p_2) \cap p_2) p_1^o 
& \text{modular law} \\
  & \leq (\top_{Y Y} (s r p_1 \cap p_2) \cap p_2) p_1^o
& \top_{Y Z} s^0 \leq \top_{Y Y}\\
  & = (p_2 (p_1^o s r p_1 \cap p_1^o p_2) \cap p_2) p_1^o 
& \top{Y Y} = p_2 p_1^o \\
  & = p_2 (p_1^o s r p_1 \cap p_1^o p_2 \cap p_2^o p_2) p_1^o
& \text{modular law} \\
  & = p_2 (p_1^o s r p_1 \cap (p_1^o \cap p_2^o) p_2) p_1^o
& \text{maps distribute} \\
  & = p_2 (p_1^o s r p_1 \cap \Delta p_2) p_1^o
& \text{see below} \\
  & = p_2 \Delta (\Delta^o p_1^o s r p_1 \cap p_2) p_1^o
& \text{modular law} \\
  & = (s r p_1 \cap p_2) p_1^o 
& p_1 \Delta = p_2 \Delta = id \\
  & = s r \cap p_2 p_1^o
& \text{modular law}
\end{aligned}
$$
and we are back to where we started.  In the fourth-last step we used the fact that if $p_1, p_2 \colon Z \times Z \to Z$ are the projections, then $p_1 \cap p_2 = \Delta^o$.  It suffices to show that $\Delta \dashv p_1 \cap p_2$; the unit inequality is actually an equality (since $\Delta$ is always monic):
$$ (p_1 \cap p_2) \Delta = p_1\Delta \cap p_2\Delta = id \cap id = id $$
while
$$ \Delta (p_1 \cap p_2) = \Delta p_1 \cap \Delta p_2$$
since $\Delta^o \Delta \leq 1$.  By the modular law we have
$$ \Delta p_1 \cap \Delta p_2 \leq p_1(\Delta \cap \Delta p_2 p_1^o)  $$
But $p_2 p_1^o = \top_{Z,Z}$, and $\Delta \top_{Z,Z} \leq \top_{Z,Z\times Z}$, so we get
$$ p_1(\Delta \cap \Delta p_2 p_1^o) \leq p_1(\Delta \cap \top_{Z,Z\times Z}) = p_1 \Delta = id $$
=--

## Related entries

Other attempted axiomatizations of the same idea "something that acts like the category of relations in a regular category" include:

* [[bicategory of relations]] (a special sort of [[cartesian bicategory]])

* [[1-category equipped with relations]]

Discussion of the relation between pretabular unitary allegories and bicategories of relations, and also between tabular unitary allegories and regular categories is in 

* [[toddtrimble:Theory of units and tabulations in allegories]]

## References

The standard monograph is 

* [[Peter Freyd]] and Andre Scedrov, _[[Categories, Allegories]]_, Mathematical Library Vol 39, North-Holland (1990). ISBN 978-0-444-70368-2.
 {#FreydScedrov}

The notion is discussed also in chapter A3 of

* [[Peter Johnstone]], _[[Sketches of an Elephant]]_

In

* [[Bob Walters]], _Categorical algebras of relations_ ([blog post](http://rfcwalters.blogspot.com/2009/10/categorical-algebras-of-relations.html) )

it is shown that any [[bicategory of relations]] is an allegory.

See also

* Wikipedia, _[Allegory](http://en.wikipedia.org/wiki/Allegory_%28category_theory%29)_


[[!redirects tabular allegory]]
[[!redirects union allegory]]
[[!redirects division allegory]]
[[!redirects power allegory]]

[[!redirects allegories]]
[[!redirects tabular allegories]]
[[!redirects union allegories]]
[[!redirects division allegories]]
[[!redirects power allegories]]
