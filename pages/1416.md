
+-- {: .rightHandSide}
+-- {: .toc .clickDown tabindex="0"}
### Context
#### Category theory
+-- {: .hide}
[[!include category theory - contents]]
=--
=--
=--

# Contents
* table of contents
{: toc}

## Idea

If $C$ is a [[finitely complete category]] (a category with all finite limits), then it is interesting to consider a left [[exact functor]] on $C$ (a functor that preserves all [[finite limit]]s).  Even if $C$ lacks some finite limits, then this concept still makes sense, but it may not be the correct one.  Instead we use the stronger concept of a _flat functor_, which may be thought of as a functor that preserves all finite limits ---even the ones that don\'t exist yet!


## Definitions

It turns out that the most appropriate generality in which to speak of a flat functor $C \to D$ is when $D$ is a [[site]].  We build up to this definition in stages through several more classical notions, remarking at each stage on some basic properties and equivalences.  Proofs will be given in the following section.


### $Set$-valued functors

The most classical notion is the following.

+-- {: .num_defn #SetValuedFlat}
###### Definition
A functor $C\to Set$ is **flat** if the opposite of its its [[category of elements]], $el(C)^{op}$, is a [[filtered category]].
=--

For disambiguation with the later notions, we may refer to such a functor as being **$Set$-valued flat**.

+-- {: .num_prop}
###### Proposition
When $C$ is [[small category|small]], a functor $F\colon C\to Set$ is $Set$-valued flat if and only if its [[Yoneda extension]] $[C^{op},Set] \to Set$ preserves finite limits.
=--

This partially explains the terminology "flat", since the Yoneda extension is a sort of [[tensor product of functors|tensoring with]] $F$, and a [[flat module]] is one such that tensoring with it preserves finite limits.

+-- {: .num_cor}
###### Corollary
If $F\colon C\to Set$ is flat, then it preserves all finite limits that exist in $C$.  Conversely, if $C$ has finite limits and $F$ preserves them, then it is flat.
=--


### Representable flatness

+-- {: .num_defn #RepresentablyFlat}
###### Definition
A functor $F\colon C \rightarrow E$ is **flat** if for each [[object]] $e \in E$, the [[opposite category|opposite]] [[comma category]] $(e / F)^{op}$ is a [[filtered category]].
=--

Since $(e/F)$ is equivalent to the category of elements of the composite $C \xrightarrow{F} E \xrightarrow{E(e,-)} Set$, this is equivalent to saying  that $E(e,F-)\colon C\to Set$ is Set-valued flat for every $e\in E$.  Hence, this notion of flatness may be called **representably flat**.

Representably flat functors are sometimes referred to simply as "[[exact functor|left exact functors]]".  On the nLab we generally reserve the latter terminology for the case when $C$ has finite limits.

+-- {: .num_prop}
###### Proposition
A functor $F \colon C \to E$ between small categories is representably flat if and only if the operation $Lan_F\colon [C^{op}, Set] \to [E^{op},Set]$ of [[left Kan extension]] preserves finite limits.
=--

+-- {: .num_cor}
###### Corollary
If $F\colon C\to E$ is representably flat, then it preserves all finite limits that exist in $C$.  Conversely, if $C$ has finite limits and $F$ preserves them, then it is representably flat.
=--

+-- {: .num_cor}
###### Corollary
If $C$ has finite limits, then a functor $C\to Set$ is representably flat if and only if it is Set-valued flat, if and only if it preserves finite limits.
=--

However, if $C$ lacks finite limits, then representable flatness of $C\to Set$ can be stronger than Set-valued flatness.


### Topos-valued functors

+-- {: .num_defn #InternallyFlat}
###### Definition
Let $E$ be a [[cocomplete category|cocomplete]] [[topos]].  A functor $F\colon C\to E$ is **flat** if the statement "$F$ is $Set$-valued flat" is true in the [[internal logic]] of $E$.

Explicitly, this means that for any finite diagram $D\colon I\to C$, the family of factorizations through $\lim (F\circ D)$ of the $F$-images of all [[cones]] over $D$ in $C$ is [[epimorphism|epimorphic]] in $E$.
=--

For disambiguation, this notion of flatness may be called **internally flat** since it refers to the internal logic of $E$.  Internally flat functors have multiple other names:

* In [Johnstone, C2.3.7 and B3.2.3](#Johnstone) they are called "torsors".
* In [Mac Lane-Moerdijk, VII.8](#MLM) they are called "filtering functors".

Since the internal logic of $Set$ is just ordinary logic, a functor $C\to Set$ is internally flat just when it is Set-valued flat.

+-- {: .num_prop}
###### Proposition
When $C$ is [[small category|small]], a functor $F\colon C\to E$ is internally flat if and only if its [[Yoneda extension]] $[C^{op},Set] \to E$ preserves finite limits.
=--

+-- {: .num_cor}
###### Corollary
If $F\colon C\to E$ is internally flat, then it preserves all finite limits that exist in $C$.  Conversely, if $C$ has finite limits and $F$ preserves them, then it is internally flat.
=--


### Site-valued functors

Finally, we can give the most general definition, due to [Karazeris](#Karazeris)

+-- {: .num_defn #CoveringFlat}
###### Definition
Let $E$ be any [[site]].  A functor $F\colon C\to E$ is **flat** if for any finite diagram $D\colon I\to C$ and any [[cone]] $T$ over $F\circ D$ in $E$ with vertex $u$, the [[sieve]]
$$ \{ h\colon v\to u | T h \;\text{ factors through the }\; F\text{-image of some cone over }\; D \} $$
is a covering sieve of $u$ in $E$.
=--

For disambiguation, we may refer to this notion as being **covering-flat**.  This subsumes the other three definitions as follows:

* If $E=Set$ with its [[canonical topology]], then covering-flatness reduces to Set-valued flatness.
* More generally, if $E$ is a cocomplete topos with its canonical topology, then covering-flatness reduces to internal flatness.
* On the other hand, if $E$ has a [[trivial topology]], then covering-flatness reduces to representable flatness.

+-- {: .num_prop}
###### Proposition
If $C$ is a small category and $E$ is a [[small-generated site]], then a functor $F \colon C \to E$ is covering-flat if and only if its extension $[C^{op}, Set] \to Sh(E)$ preserves finite limits.
=--

+-- {: .num_cor}
###### Corollary
If $F\colon C\to E$ is covering-flat, where $E$ has finite limits and all covering families in $E$ are [[extremal epimorphism|extremal-epic]], then $F$ preserves all finite limits that exist in $C$.  Conversely, if $C$ has finite limits and $F$ preserves them, then it is covering-flat.
=--


## Properties

### Yoneda extensions

We now prove the asserted propositions about the equivalence of flatness with finite-limit-preserving extensions to presheaf categories.

+-- {: .num_prop}
###### Proposition
When $C$ is [[small category|small]], a functor $F\colon C\to Set$ is Set-valued flat if and only if its [[Yoneda extension]] $[C^{op},Set] \to Set$ preserves finite limits.
=--
+-- {: .proof}
###### Proof
This is prop. 6.1.3 in ([Borceux](#Borceux)).
=--

+-- {: .num_prop}
###### Proposition
When $C$ and $E$ are [[small category|small]], a functor $F \colon C \to E$ is representably flat if and only if $Lan_F\colon [C^{op}, Set] \to [E^{op},Set]$ preserves finite limits.
=--
+-- {: .proof}
###### Proof
Since [[presheaf topos]]es have all [[colimit]]s, $F_! = Lan_F$ is computed on any object $e \in E$ (as discussed at [[Kan extension]]) by the [[colimit]]
$$ (F_! X(e) = \lim_{\to} \left( (e/F)^{op} \to C^{op} \stackrel{F}{\to} Set \right) $$
where $(e/F)$ is the corresponding [[comma category]] and $(e/F)^{op} \to C^{op}$ is the canonical projection.

Now, by definition $F$ being representably-flat means that $(e/F)^{op}$ is a [[filtered category]]. So this is a [[filtered colimit]]. By the discussion there, it is precisely the filtered colimits that commute with finite limits.
=--

+-- {: .num_prop}
###### Proposition
When $C$ is [[small category|small]] and $E$ is a cocomplete topos, a functor $F\colon C\to E$ is internally flat if and only if its [[Yoneda extension]] $[C^{op},Set] \to E$ preserves finite limits.
=--
+-- {: .proof}
###### Proof
This is VII.9.1 in [Mac Lane-Moerdijk](#MLM).
=--

If $C$ is a [[site]], $E$ is a sheaf topos, and $F\colon C\to E$ is internally flat, then the restriction of $[C^{op},Set] \to E$ to $Sh(C)$ still preserves finite limits, and it is cocontinuous just when $F$ preserves covering families.  Since cocontinuous left-exact functors between sheaf toposes are precisely the [[inverse image]] parts of [[geometric morphisms]], we conclude that cover-preserving internally-flat functors out of a site $C$ characterise geometric morphisms into $Sh(C)$.  In other words, $Sh(C)$ is the [[classifying topos]] for such functors.  This can be very useful when a [[Grothendieck topos]] has a presentation by a particularly simple site.


### Category of flat functors
 {#CategoryOfFlatFunctors}

For $A$ a [[category]] the [[full subcategory]]

$$
  FlatFunc(A^{op}, Set) \subset Func(A^{op}, Set)
$$

of the [[category of presheaves]] on $A$ 
(which is the [[free cocompletion]] of $A$) on the flat functors is the 
free cocompletion under [[filtered colimit]]s.

+-- {: .un_prop}
###### Proposition

$FlatFunc(A^{op},Set)$ has [[finite limits]] precisely if for every finite [[diagram]] $D$ in $A$, the category of [[cones]] on $D$ is [[filtered category|filtered]].

=--

This is due to ([KarazerisVelebil](#KarazerisVelebil)).


## Examples

* [[morphism of sites|Morphisms of sites]] are flat functors which additionally preserve covering families.


## References

* [[Francis Borceux]], _Handbook of categorical algebra_ , volume I, _Basic category theory_.  Representable flatness is discussed in chapter 6.
{#Borceux}

* [[Peter Johnstone]], _[[Sketches of an Elephant]]_ .  Internally flat functors ("torsors") are discussed around B3.2, and representably flat functors around C2.3.7.
 {#Johnstone}

* [[Saunders Mac Lane]] and [[Ieke Moerdijk]], _[[Sheaves in Geometry and Logic]]_ .  Set-valued flat functors are discussed in VII.6, and internally flat functors in VII.8 (both called "filtering functors").
 {#MLM}

For the relationship between the various notions of flatness, and the notion of covering-flatness, see

* [[Panagis Karazeris]], _Notions of flatness relative to a Grothendieck topology_
 {#Karazeris}

* [[Mike Shulman]], _[Flat Functors and Morphisms of Sites](http://golem.ph.utexas.edu/category/2011/06/flat_functors_and_morphisms_of.html)_
 {#Shulman}

Limits in the category of flat functors are discussed in 

* [[Panagis Karazeris]], Jiří Velebil, _Representability relative to a doctrine_ , Cahiers de Topologie et Géometrie Différentielle Catégoriques 50 (2009), 3–22.
 {#KarazerisVelebil}


[[!redirects flat functor]]
[[!redirects flat functors]]

[[!redirects representably flat functor]]
[[!redirects representably flat functors]]

[[!redirects internally flat functor]]
[[!redirects internally flat functors]]

[[!redirects covering-flat functor]]
[[!redirects covering-flat functors]]
